FROM qwen3:8b

# Context window: how many tokens the model can process at once
# Qwen3:8b supports up to 40K context. We use 16K as a practical sweet spot:
# large enough for multi-file work, conservative enough on VRAM (~6.5 GB total).
PARAMETER num_ctx 16384

# Temperature: controls randomness (0.0 = deterministic, 1.0 = creative)
# 0.3 is ideal for code: precise enough for correct syntax,
# with just enough variation to suggest alternative approaches.
PARAMETER temperature 0.3

# Top-p (nucleus sampling): only consider tokens within the top P probability mass.
# 0.9 means "pick from tokens that together cover 90% probability."
# Combined with low temperature, this cuts off unlikely/garbage completions
# while still allowing the model to choose between reasonable alternatives.
PARAMETER top_p 0.9

# Repeat penalty: penalizes tokens that already appeared in the output.
# 1.0 = no penalty, >1.0 = discourage repetition.
# 1.1 is gentle enough to allow natural code patterns (e.g., repeated keywords)
# while preventing degenerate loops where the model gets stuck.
PARAMETER repeat_penalty 1.1

# Stop sequences: special tokens that signal "end of response."
# Qwen3 uses ChatML format internally, same as Qwen2.5.
PARAMETER stop "<|im_end|>"
PARAMETER stop "<|endoftext|>"

# System prompt: skeleton format (ROLE/CONSTRAINTS/FORMAT) per closing-the-gap #2.
# Hard constraints instead of soft language — 7B models follow these more reliably.
# ~95 tokens. Each MUST/MUST NOT targets a real failure from benchmark 0.2.
SYSTEM """ROLE: Backend code generator for Java 21+ and Go 1.22+.
CONSTRAINTS:
- MUST output complete, compilable code — never pseudocode, never partial with TODOs
- MUST include error handling in every exported function
- MUST use standard library only unless the user specifies a dependency
- MUST follow idiomatic style (Java: SOLID, records, streams; Go: effective Go, error returns)
- MUST NOT add explanatory text unless the user asks to explain
- MUST NOT invent import paths or library names that do not exist
- MUST NOT over-engineer: use the simplest data structure that solves the problem
FORMAT: One fenced code block per file with language tag. If multiple files, label each."""
